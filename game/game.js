'use strict';class Game{constructor(){this.offCanvas=document.getElementById("offCanvas"),this.offContext=this.offCanvas.getContext("2d"),this.width=this.offCanvas.width,this.height=this.offCanvas.height,this.div=document.getElementById("div-canvas"),this.canvas=document.createElement("canvas"),this.canvas.width=608,this.canvas.height=608,this.div.appendChild(this.canvas),this.context=this.canvas.getContext("2d"),this.unit=32,this.trackingFps={elapsed:0,then:0,now:0,fpsInterval:0},this.mode=null,this.requestId=null,this.menu=new Menu(this),this.snake=new Snake(this),this.food=new Food(this),this.prize=new Prize(this),this.groundImg=new Image,this.groundImg.src="img/ground.webp",this.lose=!1,this.cup=new Image,this.cup.src="img/cup.webp",this.restartImg=new Image,this.restartImg.src="img/restart.webp",this.restartBtn={x:7.3*this.unit,y:14*this.unit,w:140,h:54},this.themeAu=new Audio("audio/theme.mp3"),this.hasPlayed=!1}init(){this.snake.init(),this.food.init()}startAnimating(a){this.trackingFps.fpsInterval=1e3/a,this.trackingFps.now=Date.now(),this.play()}play(){this.requestId=requestAnimationFrame(this.play.bind(this)),this.trackingFps.now=Date.now(),this.trackingFps.elapsed=this.trackingFps.now-this.trackingFps.then,this.trackingFps.elapsed>this.trackingFps.fpsInterval&&(this.trackingFps.then=this.trackingFps.now-this.trackingFps.elapsed%this.trackingFps.fpsInterval,this.themeAu.volume=.1,this.themeAu.play(),this.update(),this.draw(),this.checkLose(this.requestId))}checkLose(a){this.lose&&(this.themeAu.pause(),cancelAnimationFrame(a))}update(){this.hasPlayed&&(this.snake.update(),this.prize.update())}formatString(a){if(0===a)return`000`;const b=a.toString(),c=Math.floor(Math.log10(a));return 0===c?`${"0".repeat(2)}${b}`:1===c?`${"0".repeat(1)}${b}`:`${"0".repeat(0)}${b}`}draw(){this.offContext.drawImage(this.groundImg,0,0),this.hasPlayed?this.lose?(this.offContext.drawImage(this.cup,7*this.unit,7*this.unit,5*this.unit,5*this.unit),this.offContext.font="45px Changa One",this.offContext.fillStyle="rgb(0,0,0)",this.offContext.fillText(this.formatString(this.snake.score),8.1*this.unit,10.5*this.unit),this.offContext.font="32px Changa One",this.offContext.fillText("\u0102n nhi\u1EC1u th\xEC ph\u1EA3i kh\xE1t n\u01B0\u1EDBc",3.9*this.unit,6.3*this.unit),this.offContext.fillText("L\xE0m t\xE1ch tr\xE0 b\xECnh t\u0129nh l\u1EA1i b\u1EA1n ei! ",3*this.unit,13*this.unit),this.offContext.drawImage(this.restartImg,this.restartBtn.x,this.restartBtn.y,this.restartBtn.w,this.restartBtn.h)):(this.food.draw(),this.prize.draw(),this.snake.draw()):this.menu.draw(),this.offContext.font="20px Changa One ",this.offContext.fillStyle="rgb(255,255,255)",this.offContext.fillText("N\u1EBFu c\xF3 g\u1EB7p l\u1ED7i \u0111\u1EEBng b\xE1o cho dev, n\xF3 c\u1ECDc n\xF3 t\u1EDBi nh\xE0 n\xF3 \u0111\xE1nh!",2*this.unit,18.7*this.unit),this.context.drawImage(this.offCanvas,0,0)}getMousePos(a,b){const c=a.getBoundingClientRect();return{x:b.clientX-c.left,y:b.clientY-c.top}}btnClick(a,b){const c=this.getMousePos(this.canvas,b);return c.x>=a.x&&c.x<=a.x+a.w&&c.y>=a.y&&c.y<=a.y+a.h}}window.onload=()=>{const a=10;let b=new Game;b.init(),b.startAnimating(10),document.addEventListener("click",c=>{b.hasPlayed?b.lose&&b.btnClick(b.restartBtn,c)&&(b.div.removeChild(b.canvas),b=new Game,b.init(),b.startAnimating(a)):b.btnClick(b.menu.startBtn,c)?b.hasPlayed=!0:b.btnClick(b.menu.settingBtn,c)&&(b.menu.settingBtn.w=0,setTimeout(()=>{b.menu.settingBtn.w=2*b.unit},300))}),document.addEventListener("keydown",c=>{" "===c.key&&b.lose&&(b.div.removeChild(b.canvas),b=new Game,b.init(),b.startAnimating(a));const d=b.snake.move;switch(c.key){case"ArrowLeft":"right"!==d&&(b.snake.move="left");break;case"ArrowUp":"down"!==d&&(b.snake.move="up");break;case"ArrowRight":"left"!==d&&(b.snake.move="right");break;case"ArrowDown":"up"!==d&&(b.snake.move="down");break;default:b.snake.move="stop";}})};